<!DOCTYPE HTML>
<html>

<head>
	<title>Statistics</title>
	<link type="text/css" rel="stylesheet" href="style1.css" />
	<meta charset="utf-8">
	<script>
		function setup() {
			//alert("setting up");
			var addElementButton = document.getElementById("addElement");
			addElementButton.addEventListener("click", addValue, false);

			var computeButton = document.getElementById("compute");
			computeButton.addEventListener("click", computeStatistics, false);

			var removeElementButton = document.getElementById("removeElement");
			removeElementButton.addEventListener("click", removeValue, false);
		}

		function addValue() {

			// Function to create rows in the values table
			var tbody = document.getElementById("values");
			var lastNum = tbody.lastElementChild.firstElementChild.textContent;
			var nextNum = +lastNum + 1;
			var newRow = document.createElement("tr");
			var numCell = document.createElement("td");
			var valCell = document.createElement("td");
			var numText = document.createTextNode(nextNum + "");
			numCell.appendChild(numText);

			// Create the X value field and add to its respective column
			var input = document.createElement("input");
			input.setAttribute("name", "xvalue");
			input.setAttribute("type", "text");
			valCell.appendChild(input);

			// Create a value field for the Y value + add to respective column
			var yValCell = document.createElement("td");
			var yInput = document.createElement("input");
			yInput.setAttribute("name", "yvalue");
			yInput.setAttribute("type", "text");

			// Add the y-value field to its respective column
			yValCell.appendChild(yInput);
			newRow.appendChild(numCell);
			newRow.appendChild(valCell);
			newRow.appendChild(yValCell);
			tbody.appendChild(newRow);
		}

		function removeValue() {
			var tbody = document.getElementById("values");

			if (tbody.childElementCount > 1) {
				// leave at least one value  row
				tbody.removeChild(tbody.lastElementChild);
			}
		}

		function removeChildForElement(elementID) {
			var theSpan = document.getElementById(elementID);
			if (theSpan.lastChild) {
				theSpan.removeChild(theSpan.lastChild);
			}

			return theSpan;
		}

		function standardDeviation(values) {
			// get the mean then subtract all values from it + square values
			var meanValues = computeAverage(values);
			var standardDeviationValues = 0;
			var x = 0;
			
			for (i = 0; i < values.length; i++) {
				x = values[i].value - meanValues;
				standardDeviationValues += Math.pow(x,2);
			}

			var meanNewValues = standardDeviationValues/values.length;

			return Math.sqrt(meanNewValues);
		}

		function computeSum(values) {
			// Helper function to calculate the sum of values provided.
			var sum = 0;
			for (i = 0; i < values.length; i++) {
				sum += +values[i].value;
			}
			return sum;
		}

		function computeAverage(data) {
			return computeSum(data)/data.length;
		}

		function computeStatistics() {

			var valuesY = document.getElementsByName("yvalue");
			var valuesX = document.getElementsByName("xvalue");
			var countSpan = document.getElementById("countOutput");
			countSpan.appendChild(document.createTextNode(valuesX.length + valuesY.length));
			countSpan.normalize();

			var correlationSpan = removeChildForElement("correlationOutput");
			// correlationSpan.appendChild(document.createTextNode(countSpan.length));
			var sdValues =  standardDeviation(valuesX);
			correlationSpan.appendChild(document.createTextNode(sdValues));

			var sumXvalues = computeSum(valuesX);
			var sumYvalues = computeSum(valuesY);
			var sumSpanX = removeChildForElement("sumOutputX");
			sumSpanX.appendChild(document.createTextNode(sumXvalues));

			var sumSpanY = removeChildForElement("sumOutputY");
			sumSpanY.appendChild(document.createTextNode(sumYvalues));

			var averageSpanX = removeChildForElement("averageOutputX");
			averageSpanX.appendChild(document.createTextNode(sumXvalues / valuesX.length));

			var averageSpanY = removeChildForElement("averageOutputY");
			averageSpanY.appendChild(document.createTextNode(sumYvalues / valuesY.length));

		}

	</script>
</head>

<body>
	<div id="value-area">
		<h2>Values</h2>
		<!-- Left table - user enters values for X and Y and adds/removes rows -->
		<table id="elementTable">
			<thead>
				<tr>
					<th>Index</th>
					<th>X Value</th>
					<th>Y Value</th>
				</tr>
			</thead>

			<tbody id="values">
				<tr>
					<td>1</td>
					<td>
						<input type="text" name="xvalue" />
					</td>
					<td>
						<input type="text" name="yvalue" />
					</td>
				</tr>
			</tbody>
		</table>
		<button id="addElement">Add Value</button>
		<button id="removeElement">Remove Value</button>
	</div>
	<div id="stat-area">
		<h2>Statistics</h2>
		<!-- Left table - user enters values for X and Y and adds/removes rows -->
		<table id="elementTable">
			<tbody id="sum">
				<tr>
					<td>Sum</td>
					<td>
						<span id="sumOutputX"></span>
					</td>
					<td>
						<span id="sumOutputY"></span>
					</td>
				</tr>
				</tbody>
				<tbody id="average">

				<tr>
					<td>Average</td>
					<td id="averageOutputX"></td>
					<td id="averageOutputY"></td>
				</tr>
				</tbody>
				<tbody id="correlation">

				<tr>
					<td>Correlation</td>

					<td colspan="2" id="correlationOutput"></td>
					</tr>
			</tbody>
			<tbody id="count">

			<tr>
				<td>Count</td>
				<td colspan="2" id="countOutput"></span>
				</td>
				</tr>
			</tbody>

		</table>
		<button id="compute">Compute Statistics</button>
	</div>
	<script>
		setup();
	</script>
</body>

</html>
